<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>polymer</title>


    <!-- metaworks3 for ie7(json2) -->
    <script type="text/javascript" src="dwr/metaworks/scripts/json/json2.js"></script>

    <!-- metaworks3 for dwr engine -->
    <script type='text/javascript' src='dwr/engine.js'></script>
    <script type='text/javascript' src='dwr/util.js'></script>
    <script type='text/javascript' src='dwr/interface/Metaworks.js'></script>

    <!-- metaworks3 for jQuery -->
    <!-- <script type="text/javascript" src="dwr/metaworks/scripts/jquery/jquery-1.8.3.min.js"></script>  -->
    <script type="text/javascript" src="lib/jquery-1.11.1/jquery-1.11.1.min.js"></script>

    <!-- metaworks3 for keyboard mapping -->
    <script type="text/javascript" src="dwr/metaworks/scripts/event/shortcut.js"></script>

    <!-- metaworks3 for context menu, import YUI -->
    <!--<link rel="stylesheet" type="text/css" href="dwr/metaworks/style/menu/reset.css">-->
    <!--<link rel="stylesheet" type="text/css" href="dwr/metaworks/style/menu/container.css">-->
    <!--<link rel="stylesheet" type="text/css" href="dwr/metaworks/style/menu/sam/menu.css">-->

    <script type="text/javascript" src="dwr/metaworks/scripts/yui-3.2.0-min.js"></script>
    <script type="text/javascript" src="dwr/metaworks/scripts/yui/build/utilities/utilities.js"></script>
    <script type="text/javascript" src="dwr/metaworks/scripts/yui/build/container/container.js"></script>
    <script type="text/javascript" src="dwr/metaworks/scripts/yui/build/menu/menu.js"></script>

    <!-- metaworks3 for ejs templete engine -->
    <script type="text/javascript" src="dwr/metaworks/scripts/ejs/ejs_production.js"></script>
    <script type="text/javascript" src="dwr/metaworks/scripts/ejs/ejs_debugger.js"></script>
    <script type="text/javascript" src="dwr/metaworks/scripts/ejs/view.js"></script>

    <!-- metaworks3 engine -->
    <script type="text/javascript" src="dwr/metaworks/scripts/metaworks.js"></script>

    <script type="text/javascript" src="lib/jquery/jquery.contextMenu.js"></script>

    <script type="text/javascript" src="scripts/OpenGraph-0.1-SNAPSHOT.js"></script>
    <script type="text/javascript" src="lib/jquery-ui-1.11.0.custom/jquery-ui.js"></script>
    <script type="text/javascript" src="lib/jquery/jquery.layout-latest.js"></script>

    <!--<link rel="stylesheet" type="text/css" href="lib/jquery-ui-1.11.0.custom/jquery-ui.min.css" />-->

    <script type="text/javascript">
//      $(document).ready(function() {
//        mw3.setWhen(mw3.WHEN_EDIT);
//
//        var runner = new MetaworksObject({
//          __className : "Login",
//        }, 'body');
//
//        mw3.onLoadFaceHelperScript();
//      });

      mw3.Polymer = function(proto){
        var metadata = mw3.getMetadata(proto.java);

        if(!proto.properties) proto.properties = {};

        var typeMapping = {
          'java.lang.String': String,
          'java.lang.int': Number,
          'java.lang.Number': Number,
          'java.lang.long': Number,
          'java.lang.boolean': Boolean,
          'java.lang.Boolean': Boolean,
          'java.util.Date': Date,
        };

        for(var idx in metadata.fieldDescriptors){
          var field = metadata.fieldDescriptors[idx];

          var type = typeMapping[field.className];
          if(!type) type = Object;

          proto.properties[field.name] = {
            type: type
          }
        }

        proto.properties.__className = {
          type: String,
          value: proto.java
        }


        for(var idx in metadata.serviceMethodContexts){
          var method = metadata.serviceMethodContexts[idx];

          proto["_"+method.methodName] = function(){


            var serviceMethodContext = method;
            var objectForCall;
            var object = this;
            var objectMetadata = metadata;

            if(serviceMethodContext.callByContent == false){
              if(serviceMethodContext.payload){

                var beanPaths = [];
                for(var key in serviceMethodContext.payload){

                  if(key.indexOf("wireParamCls:") != 0)
                    beanPaths.push(key);
                }

                objectForCall = mw3.___copyBeanPathsOnly(this, beanPaths);

              }else
                objectForCall = this._createKeyObject(object); //default option
            }else{

              objectForCall = {__className: object.__className, metaworksContext: object.metaworksContext};

              //we have to copy all the field values for objectForCall since there's too many additional JSON fields for call methods.
              for(var i in objectMetadata.fieldDescriptors){
                var fd = objectMetadata.fieldDescriptors[i];

                if(object!=null && object[fd.name]!=null && (!serviceMethodContext.except || !serviceMethodContext.except[fd.name]))
                  objectForCall[fd.name] = object[fd.name];
              }
            }


            mw3.metaworksProxy.callMetaworksService(this.__className, objectForCall, method.methodName, null,
                    {
                      callback: function(result){

                        returnValue = result;
                        var target = object;

                        if(serviceMethodContext.target != "none"){

                          if(result.__className == object.__className){


                          }else{
                            var moduleId = mw3.polymerMapping[result.__className];

                            target = document.querySelector(moduleId);

                          }
                        }

                        if(target){
                          objectMetadata = mw3.getMetadata(target.__className);

                          for(var i in objectMetadata.fieldDescriptors){
                            var fd = objectMetadata.fieldDescriptors[i];

                            target[fd.name] = result[fd.name];
                          }
                        }

                      },

                      async: method.target!="none",

                      errorHandler:function(errorString, exception) {
                        if(method.target=="none")
                          throw exception;
                      }

                    }
            );
          }
        }

        Polymer(proto);

        if(!mw3.polymerMapping)
          mw3.polymerMapping = {};

        mw3.polymerMapping[proto.java] = proto.is;

      };

    </script>

    <!-- end of mw3 dependencies -->

    <meta name="description" content="polymer description">

    <!-- See https://goo.gl/OOhYW5 -->
    <link rel="manifest" href="/manifest.json">

    <script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>

    <link rel="import" href="/src/polymer-app/polymer-app.html">
    <link rel="import" href="/src/polymer-app/login.html">
    <link rel="import" href="/src/polymer-app/main.html">
    <link rel="import" href="/src/polymer-app/user.html">

  </head>
  <body>
    <polymer-app></polymer-app>
    <uengine-login></uengine-login>
    <uengine-main></uengine-main>
  </body>
</html>
